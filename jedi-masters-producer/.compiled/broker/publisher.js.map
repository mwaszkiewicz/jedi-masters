{"version":3,"sources":["../../src/broker/publisher.js"],"names":["Publisher","publish","msg","queue","err","channel","conn","console","error","stack","log","sendToQueue","encode","persistent","setImmediate","close","doc","Buffer","JSON","stringify"],"mappings":"2EAAA,oC;;AAEqBA,S;;AAEjB,qBAAc;;AAEhBC,WAFgB,GAEN,UAACC,GAAD,EAAMC,KAAN,EAAgB;AACtB,+BAAQA,KAAR,EAAe,UAACC,GAAD,EAAMC,OAAN,EAAeC,IAAf,EAAwB;AACnC,gBAAIF,GAAJ,EAAS;AACLG,wBAAQC,KAAR,CAAcJ,IAAIK,KAAlB;AACH,aAFD,MAEM;AACFF,wBAAQG,GAAR,CAAY,QAAZ,EAAsBR,GAAtB;AACAG,wBAAQM,WAAR,CAAoBR,KAApB,EAA2B,MAAKS,MAAL,CAAYV,GAAZ,CAA3B,EAA6C;AACzCW,gCAAY,IAD6B,EAA7C;;AAGAC,6BAAa,YAAM;AACfT,4BAAQU,KAAR;AACAT,yBAAKS,KAAL;AACH,iBAHD;AAIH;AACJ,SAbD;AAcH,KAjBe;;AAmBhBH,UAnBgB,GAmBP,UAACI,GAAD,EAAS;AACd,eAAO,IAAIC,MAAJ,CAAWC,KAAKC,SAAL,CAAeH,GAAf,CAAX,CAAP;AACH,KArBe,CAAG,C,mBAFAhB,S","file":"publisher.js","sourcesContent":["import Channel from './channel';\r\n\r\nexport default class Publisher {\r\n\r\n    constructor() { }\r\n\r\n  publish = (msg, queue) => {\r\n      Channel(queue, (err, channel, conn) => {\r\n          if (err) {\r\n              console.error(err.stack);\r\n          }else {\r\n              console.log('msg %j', msg);\r\n              channel.sendToQueue(queue, this.encode(msg), {\r\n                  persistent: true\r\n              });\r\n              setImmediate(() => {\r\n                  channel.close();\r\n                  conn.close();\r\n              });\r\n          }\r\n      });\r\n  };\r\n\r\n  encode = (doc) => {\r\n      return new Buffer(JSON.stringify(doc));\r\n  };\r\n}\r\n"]}